<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Yêu Cầu 6</title>
</head>
<body>
<script>
    let thongTinCanNhap = ["Tên","CMND","Ngày , tháng , năm sinh","Email", "Địa chỉ", "Loại Customer", "Phần trăm giảm giá","Số lượng đi kèm",
        "Số ngày thuê", "Loại dịch vụ","Loại phòng"];
    let listCustomer = new Array();
    let j = 0;
    let soThuTu;
    let info;
    let customer;



    class Customer {
        constructor(name, idCard, birthDay, email, address, typeCustomer, disCount, quantityIncluded, rentDays, typeOfService, kindOfRoom) {
            this.name = name;
            this.idCard = idCard;
            this.birthDay = birthDay;
            this.email = email;
            this.address = address;
            this.typeCustomer = typeCustomer;
            this.disCount = disCount;
            this.quantityIncluded = quantityIncluded;
            this.rentDays = rentDays;
            this.typeOfService = typeOfService;
            this.kindOfRoom = kindOfRoom;
        }

        setName(name) {
            this.name = name;
        }

        setIdCard(idCard) {
            this.idCard = idCard;
        }

        setBirthDay(birthday) {
            this.birthDay = birthday;
        }

        setEmail(email) {
            this.email = email;
        }

        setAddress(address) {
            this.address = address;
        }

        setTypeCustomer(typeCustomer) {
            this.typeCustomer = typeCustomer;
        }

        setDisCount(discount) {
            this.disCount = discount;
        }

        setQuantityIncluded(quantityIncluded) {
            this.quantityIncluded = quantityIncluded;
        }

        setRentDays(rentDays) {
            this.rentDays = rentDays;
        }

        setTypeOfService(typeOfService) {
            this.typeOfService = typeOfService;
        }

        setKindOfRoom(kindOfRoom) {
            this.kindOfRoom = kindOfRoom;
        }

        getName() {
            return this.name;
        }

        getIdCard() {
            return this.idCard;
        }

        getBirthDay() {
            return this.birthDay;
        }

        getEmail() {
            return this.email;
        }

        getAddress() {
            return this.address;
        }

        getTypeCustomer() {
            return this.typeCustomer;
        }

        getDisCount() {
            return this.disCount;
        }

        getQuantityIncluded() {
            return this.quantityIncluded;
        }

        getRentDays() {
            return this.rentDays;
        }

        getTypeOfService() {
            return this.typeOfService;
        }

        getKindOfRoom() {
            return this.kindOfRoom;
        }

        tinhTien() {
            if (this.typeOfService === "Villa") {
                return 500 * parseInt(this.rentDays) * (1 - (parseInt(this.disCount) / 100)) + " $.";
            } else if (this.typeOfService === "House") {
                return 300 * parseInt(this.rentDays) * (1 - (parseInt(this.disCount) / 100)) + " $.";
            } else {
                return 100 * parseInt(this.rentDays) * (1 - (parseInt(this.disCount) / 100)) + " $.";
            }
        }
    }



    displayMainMenu();



    function displayMainMenu() {
        let choose = prompt("Nhập thao tác muốn thực hiện:\n 1. Add New Customer\n 2. Display Information Customer" +
            "\n 3. Display total pay of customer\n 4. Edit Information Customer\n 5. Delete Customer\n 6. Exit");
        switch (choose) {
            case "1":
                let newCustomer = new Customer();
                addNewCustomer(newCustomer);
                displayMainMenu();
                break;
            case "2":
                alert(displayCustomer());
                displayMainMenu();
                break;
            case "3":
                displayTotalPayOfCustomer();
                displayMainMenu();
                break;
            case "4":
                editInformationCustomer();
                break;
            case "5":
                deleteCustomer();
                break;
            case "6":
                break;
            default:
                alert("Failed");
                displayMainMenu();
        }
    }



    function addNewCustomer(newCustomer) {
        listCustomer[j] = new Array();
        newCustomer.setName(prompt("Nhập tên :"));
        listCustomer[j].push(newCustomer.getName());
        newCustomer.setIdCard(prompt("Nhập CMND :"));
        listCustomer[j].push(newCustomer.getIdCard());
        let birthday;
        do {
            birthday = prompt("Nhập ngày , tháng , năm sinh :\nTheo định dạng : ngày/tháng/năm\n Ví dụ : 31/01/2001");
            let cutMonth = birthday.slice(3,5); // lấy 2 số của tháng
            let cutDate = birthday.slice(0,2);
            let cutYear = birthday.slice(6);
            let testMonth = birthday.indexOf("/");
            let testDate = birthday.lastIndexOf("/");
            let testDauCong = birthday.indexOf("+");
            //let test = new Date(dateOfBirth); test =="Invalid Date"
            if (isNaN(cutMonth) == true || isNaN(cutDate) == true || isNaN(cutYear) == true ||
                cutMonth <= 0 || cutMonth > 12 || cutDate <= 0 || cutDate > 31
                || (cutDate == "30") &&  (cutMonth == "02")
                || (cutDate == "31") && ((cutMonth == "02")
                    ||  (cutMonth == "04")
                    ||  (cutMonth == "06")
                    ||  (cutMonth == "09")
                    ||  (cutMonth == "11"))
                || testMonth < 2 || testDate < 2
                || testDauCong > -1 || cutYear <= 1890 || cutYear > new Date().getFullYear() ) {
                alert("Ngày tháng năm sinh không hợp lệ !");
                continue;
            }
            break;
        } while (1);
        newCustomer.setBirthDay(birthday);
        listCustomer[j].push(newCustomer.getBirthDay());
        let check4 = true;
        let email;
        do {
            email = prompt("Nhập Email :");
            let aCong = email.indexOf("@");
            let dauCham = email.lastIndexOf(".");
            if ((aCong < 1) || (dauCham < aCong + 4) || (dauCham + 4 > email.length)) {
                // aCong < n thì trước @ là n kí tự
                // dauCham < aCong+n' thì trước dấu chấm là n'-1 kí tự
                alert("Email của bạn không hợp lệ !");
            } else check4 = false;
        } while (check4);
        newCustomer.setEmail(email);
        listCustomer[j].push(newCustomer.getEmail());
        newCustomer.setAddress(prompt("Nhập địa chỉ :\nTên Thành phố :"));
        listCustomer[j].push(newCustomer.getAddress());
        newCustomer.setTypeCustomer(prompt("Nhập loại Customer :\nDiamond, Platinum, Gold, Silver, Member"));
        listCustomer[j].push(newCustomer.getTypeCustomer());
        newCustomer.setDisCount(prompt("Nhập phần trăm giảm giá :\n1.Giá trị từ 1- 100\n2.Đơn vị (%)"));
        listCustomer[j].push(newCustomer.getDisCount());
        newCustomer.setQuantityIncluded(prompt("Nhập số lượng đi kèm :"));
        listCustomer[j].push(newCustomer.getQuantityIncluded());
        newCustomer.setRentDays(prompt("Nhập số ngày thuê :"));
        listCustomer[j].push(newCustomer.getRentDays());
        newCustomer.setTypeOfService(prompt("Nhập loại dịch vụ :\nVilla: 500$/1 ngày\nHouse: 300$/1 ngày\nRoom: 100$/1 ngày"));
        listCustomer[j].push(newCustomer.getTypeOfService());
        newCustomer.setKindOfRoom(prompt("Nhập loại phòng :\nVip, Business,  Normal"));
        listCustomer[j].push(newCustomer.getKindOfRoom());
        alert(displayInformation(j));
        j++;
    }



    function displayInformation(j) {
        info = "";
        for (let i=0;i < thongTinCanNhap.length ;i++){
            info += (i+1) + ". " + thongTinCanNhap[i] + ' : ' + listCustomer[j][i] + '\n';
        }
        return info;
    }



    function nameAndCMND() {
        let nameVaCMND = "";
        soThuTu = 1;
        for (let phanTu=0;phanTu<listCustomer.length;phanTu++){
            nameVaCMND += soThuTu + '. ';
            for (let i=0;i<2;i++){
                if (thongTinCanNhap[i] === 'Tên') {
                    nameVaCMND += "Tên : " + listCustomer[phanTu][i]  + '\n';
                    continue;
                }
                nameVaCMND += "  " + "CMND : " + listCustomer[phanTu][i] + '\n';
            }
            soThuTu++;
        }
        return nameVaCMND;
    }



    function displayCustomer() {
        let choose = parseInt(prompt(nameAndCMND() + soThuTu + '. Back'));
        if (choose <=0 || isNaN(choose) || choose > soThuTu){
            alert("Lựa chọn của bạn không tồn tại !");
            return  displayCustomer();
        }
        else if (choose === soThuTu) {
            return  displayMainMenu();
        }
        else {
            customer = choose;
            return displayInformation(customer-1);
        }
    }




    function editInformationCustomer() {
        let choose = parseInt(prompt(displayCustomer() + (thongTinCanNhap.length + 1) + '. Back'));
        if (choose <= 0 || choose > (thongTinCanNhap+2) || isNaN(choose)){
            alert("Lựa chọn của bạn không tồn tại !");
            editInformationCustomer();
        }
        else if ( choose === (thongTinCanNhap.length + 1)){
            editInformationCustomer();
        }
        else {
            let edit = prompt("Nhập " + thongTinCanNhap[choose - 1] + ' muốn thay đổi :');
            listCustomer[customer - 1][choose - 1] = edit;
            alert(displayInformation(customer-1));
        }
        displayMainMenu();
    }



    function deleteCustomer () {
        let choose = parseInt(prompt(nameAndCMND() + soThuTu + " . Back"));
        if (choose <=0 || isNaN(choose) || choose > soThuTu){
            alert("Lựa chọn của bạn không tồn tại !");
            deleteCustomer();
        }
        else if (choose === soThuTu) {
            displayMainMenu();
        }
        else {
            customer = choose;
            let confirm = prompt("Bạn có thực sự muốn xóa Customer này hay không ?" + "\n" + "1. Yes" + "\n" + "2. No");
            switch (confirm) {
                case "1":
                    listCustomer.splice((choose-1),1);
                    break;
                case "2":
                    break;
                default :
                    deleteCustomer();
            }
        }
        displayMainMenu();
    }



    // function displayTotalPayOfCustomer() {
    //     let choose = parseInt(prompt(nameAndCMND() + soThuTu + '. Back'));
    //     if (choose <=0 || isNaN(choose) || choose > soThuTu){
    //         alert("Lựa chọn của bạn không tồn tại !");
    //         return  displayTotalPayOfCustomer();
    //     }
    //     else if (choose === soThuTu) {
    //         return  displayTotalPayOfCustomer();
    //     }
    //     else {
    //         return listCustomer[choose].tinhTien();
    //     }
    // }
</script>
</body>
</html>